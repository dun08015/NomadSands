# NomadSands

Living in remote locations, players have a difficult time being competitive due to high ping. NomadSands brings remote players together to coordinate private matches in their own geographic region.

I started a website called NomadSands.com in January 2020 with the purpose of allowing people who play video games to meet up in a Discord server to play a game together. The site uses Oauth2 with Discord to allow users to login with their Discord credentials. Oauth2 requests to Discord are redirected back to Nomad Sands where Node.js is used on the back-end to receive the redirect and get the user's access token. With the access token, Nomad Sands makes a request to Discord to get the user's avatar image and the servers (also known as guilds) the user belongs to. This is later used to update the login menu with the user's Discord username and avatar. For now, the username, avatar, and user guilds are saved to the session data on the server for later. 

Before logging in, users can view matches but they cannot create. When create is selected, A modal appears notifying the user that they must log in to create a match.

Once a user logs in, the user has the ability to create a match. This is verified with Node.js on the server by checking that the username value is set on the session. 

Now that the user is logged in, they can now create a match. The "matches" users can create are not actually joinable games but joinable Discord guilds where players can coordinate a private multiplayer match. Besides viewing matches, logged in users also have the ability to create matches. When a user selects "Create Match", a modal form is displayed and a request is made back to the server to get the guilds the user manages.  A modal dropdown is then populated with all the user's guilds. The user can now fill in the form with information including the game they want to play, match title, what time they want to play, and how many people they want to play with.

Before the match can be created, there is one important issue to address. To keep Nomad Sands matches up to date with the user's Discord guild, there must be a method for retrieving updates from the user's guild. Discord provides this functionality with bots. A web application can have a bot associated with it and that bot can be added to a user's guild. Bot's cannot just add themselves to a guild, they must be invited by the user. Nomad Sands handles this by using the discord.js api to interface with the bot. Using the bot interface, the bot can be queried to determine if it is already in any of the user's guilds. If it is not in the guild, a hidden input field is populated to signify the member status of the bot. When the user selects the guild they would like to use for the match, if the hidden field tied to the guild has a false value, then a hidden button to add the bot is revealed. When this button is clicked, the user is temporarily redirected to Discord to authorize the bot. Upon return, the guild can now be used to create a match and the "Add Bot" button no longer appears for that guild.

Once a match is created using a guild with a Nomad Sands bot member, an AJAX request to add the match to a mongoDB collection is executed. Upon successful response, the page is updated with the latest match addition appended.

When the main page loads for the first time after logging in, an AJAX request is made to the server to get all the matches. The server then queries the mongoDB for all the matches. The matches get returned to the AJAX call where JavaScript and jQuery are used to generate HTML with the retrieved match data and append the new match to a parent div which is part of the static HTML.  A check is also performed while loading matches to see if the logged in user is a creator on any of the matches. If so, the option to join the match is disabled as they are already a member and instead "Join" is replaced with the option to "Delete".

The match "Join" button is populated with a URL for the guild invitation created by the bot and the "Delete" button is handled with an AJAX request to delete the match using the unique id from mongoDB and the page is updated upon a successful return using jQuery. 

There is also match search functionality which triggers an AJAX request to the server where mongoDB is queried for a match title, game name, or creator with text containing the search parameter. When the response returns, all the matches are cleared from the parent using jQuery and the response matches are loaded in.
